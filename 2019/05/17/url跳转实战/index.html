<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>渗透之url跳转 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言最近在一些厂商项目中开始接触到一些url任意重定向，虽然是低危，奖金较低，（虽然国外已经是几百$）但是一旦找到突破点，几乎整个站的url跳转都可以bypass，一个厂商所有点的url跳转加起来奖金也比较可观，所以将自己挖掘过程中一点点心得分享一下。 简介先走个流程说些废话，url重定向漏洞也称url任意跳转漏洞，网站信任了用户的输入导致恶意攻击，url重定向主要用来钓鱼，比如url跳转中最常见">
<meta name="keywords" content="web漏洞">
<meta property="og:type" content="article">
<meta property="og:title" content="渗透之url跳转">
<meta property="og:url" content="http://yoursite.com/2019/05/17/url跳转实战/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言最近在一些厂商项目中开始接触到一些url任意重定向，虽然是低危，奖金较低，（虽然国外已经是几百$）但是一旦找到突破点，几乎整个站的url跳转都可以bypass，一个厂商所有点的url跳转加起来奖金也比较可观，所以将自己挖掘过程中一点点心得分享一下。 简介先走个流程说些废话，url重定向漏洞也称url任意跳转漏洞，网站信任了用户的输入导致恶意攻击，url重定向主要用来钓鱼，比如url跳转中最常见">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558097661.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558098332.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558098367.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558101310.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558101163.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558101492.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558102061.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558102491.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558102982.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558103200.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558103809.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558155397.jpg">
<meta property="og:image" content="http://47.106.185.69/1/./img/1558155773.jpg">
<meta property="og:updated_time" content="2019-05-18T05:33:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="渗透之url跳转">
<meta name="twitter:description" content="前言最近在一些厂商项目中开始接触到一些url任意重定向，虽然是低危，奖金较低，（虽然国外已经是几百$）但是一旦找到突破点，几乎整个站的url跳转都可以bypass，一个厂商所有点的url跳转加起来奖金也比较可观，所以将自己挖掘过程中一点点心得分享一下。 简介先走个流程说些废话，url重定向漏洞也称url任意跳转漏洞，网站信任了用户的输入导致恶意攻击，url重定向主要用来钓鱼，比如url跳转中最常见">
<meta name="twitter:image" content="http://47.106.185.69/1/./img/1558097661.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-url跳转实战" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/17/url跳转实战/" class="article-date">
  <time datetime="2019-05-16T16:00:00.000Z" itemprop="datePublished">2019-05-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      渗透之url跳转
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在一些厂商项目中开始接触到一些url任意重定向，虽然是低危，奖金较低，（虽然国外已经是几百$）但是一旦找到突破点，几乎整个站的url跳转都可以bypass，一个厂商所有点的url跳转加起来奖金也比较可观，所以将自己挖掘过程中一点点心得分享一下。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>先走个流程说些废话，url重定向漏洞也称url任意跳转漏洞，网站信任了用户的输入导致恶意攻击，url重定向主要用来钓鱼，比如url跳转中最常见的跳转在登陆口，支付口，也就是一旦登陆将会跳转任意自己构造的网站，如果设置成自己的url则会造成钓鱼，浅析危害。</p>
<pre><code>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;form method=&quot;get&quot; action=&quot;url.php&quot;&gt;
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
username:
&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;
&lt;br&gt;&lt;br&gt;
password:
&lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;登陆&quot; name=&quot;password&quot;&gt;
&lt;/form&gt;

&lt;?php

$url=$_GET[&apos;redict&apos;];
echo $_GET[&apos;username&apos;];
if ($_GET[&apos;username&apos;]&amp;&amp;$_GET[&apos;password&apos;]) {

    header(&quot;Location:$url&quot;);exit;
}

?&gt;</code></pre><p><img src="http://47.106.185.69/1/./img/1558097661.jpg" alt></p>
<p>最简单的代码实例，也是很贴近真实渗透的案例，登陆跳转，后面通常是加上自己业务的url，一旦存在url任意重定向，发送给用户，会毫不疑问的输入账号密码登陆，然后跳转到我们想要他跳转的url，比如：</p>
<p>我们发送给用户这样的url，</p>
<pre><code>http://127.0.0.1/url.php?username=&amp;password=&amp;redict=http://127.0.0.1/fish.php</code></pre><p>用户正常输入账号密码登陆点击登陆。跳转到构造的页面。(我可真是个钓鱼鬼才)</p>
<p><img src="http://47.106.185.69/1/./img/1558098332.jpg" alt></p>
<p><img src="http://47.106.185.69/1/./img/1558098367.jpg" alt></p>
<p>当然钓鱼界面可以伪造一切你想获取的信息。</p>
<h1 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h1><p>其实bypass没什么新的套路(我暂时没)，都是网上有的，师傅们可以百度到的，我整理一下，利用上面的代码简单测试，都是本地测试通过的。<a href="http://www.xiaozhupeiqi.com是服务器要求跳转的url。" target="_blank" rel="noopener">www.xiaozhupeiqi.com是服务器要求跳转的url。</a></p>
<p>1.最常用的一条：@绕过。</p>
<pre><code>http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=http://www.xiaozhupeiqi.com@www.baidu.com //ssrf也可用</code></pre><p>2.绕过一些匹配特定字符。</p>
<p>？绕过</p>
<pre><code>http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=http://www.baidu.com?www.xiaozhupeiqi.com</code></pre><p>#绕过</p>
<pre><code>http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=http://www.baidu.com#www.xiaozhupeiqi.com</code></pre><p>3.斜杠/绕过</p>
<pre><code>http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=http://www.baidu.com/www.xiaozhupeiqi.com</code></pre><p>或者反斜线</p>
<pre><code>http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=http://www.baidu.com\www.xiaozhupeiqi.com</code></pre><p>4.白名单匹配绕过</p>
<pre><code>比如匹配规则是必须跳转，xiaozhupeiqi.com 域名下，?#等都不行的时候，如果匹配规则为xiaozhupeiqi.com，可以尝试百度inurl:xiaozhupeiqi.com的域名，比如
aaaxiaozhupeiqi.com，这样同样可以绕过。接下来实战中会用到，</code></pre><p>5.xip.io绕过</p>
<pre><code>http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=http://www.xiaozhupeiqi.com.220.181.57.217.xip.io</code></pre><p>会跳转到百度</p>
<p>6.理想化方法</p>
<pre><code>如果有机会在自己的页面设置url跳转，比如目标网站的bbs论坛自己的资料页面设置url跳转，既然是服务器的网站，那么url是不会限制的，可以用一个漏洞去构造另一个漏洞。</code></pre><p>7.白名单网站可信</p>
<pre><code>如果url跳转点信任百度url，google url或者其他，则可以多次跳转达到自己的恶意界面。</code></pre><p>8.协议绕过</p>
<pre><code>http与https协议转换尝试，或者省略

http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=//www.xiaozhupeiqi.com@www.baidu.com
http://127.0.0.1/url.php?username=1&amp;password=1&amp;password=1&amp;redict=////www.xiaozhupeiqi.com@www.baidu.com//多斜线</code></pre><p>9.xss跳转</p>
<pre><code>这种就没啥说的了，就是XSS造成的跳转，下面也有案例，在有些情况下XSS只能造成跳转的危害。    

&lt;meta  content=&quot;1;url=http://www.baidu.com&quot; http-equiv=&quot;refresh&quot;&gt;</code></pre><h1 id="fuzz几个参数"><a href="#fuzz几个参数" class="headerlink" title="fuzz几个参数"></a>fuzz几个参数</h1><pre><code>redirect

url

redirectUrl

callback

return_url

toUrl

ReturnUrl

fromUrl

redUrl

request

redirect_to

redirect_url

jump

jump_to

target

to

link

linkto

domain</code></pre><h1 id="实战几个案例"><a href="#实战几个案例" class="headerlink" title="实战几个案例"></a>实战几个案例</h1><p>1.最常见的登陆跳转</p>
<p>登陆跳转我认为是最常见的跳转类型，几乎百分之七八十网站都会url里设置跳转，所以在登陆的时候建议多观察url参数，通常都会存在跳转至于存不存在漏洞需要自己测试。</p>
<p>上面的类型四,</p>
<p>漏洞url ：</p>
<pre><code>https://xx.xxx.com/User/Login?redirect=http://xxx.com/</code></pre><p><img src="http://47.106.185.69/1/./img/1558101310.jpg" alt></p>
<p>为登陆页面，如果登陆成功那么跳转<a href="http://xxx.com/，但是所有方式都无法绕过，但是发现可以跳转aaxxx.com，也就是匹配规则为必须为xxx.com的网址，但是aaxxx.com同样也可以。" target="_blank" rel="noopener">http://xxx.com/，但是所有方式都无法绕过，但是发现可以跳转aaxxx.com，也就是匹配规则为必须为xxx.com的网址，但是aaxxx.com同样也可以。</a></p>
<p>方法：</p>
<p>百度 inurl:xxx.com，即可百度到很多域名包含xxx.com的url，即可实现跳转,不小心百度到一个黄域，正好证明危害登陆跳XX网。</p>
<p><img src="http://47.106.185.69/1/./img/1558101163.jpg" alt></p>
<p>还有一些花里胡哨的base64加码了的跳转，解码就是需要跳转的url,其实本质都一样，</p>
<p><img src="http://47.106.185.69/1/./img/1558101492.jpg" alt></p>
<p>2.@绕过</p>
<p>@是最常见的一种绕过。</p>
<p>漏洞url</p>
<pre><code>https://xx.xxx.com/user/goToLogin?toUrl=https://xx.xxx.com@www.baidu.com</code></pre><p>这种跳转在chrome浏览器可以直接跳转，但是在火狐会弹框询问，但是并不影响它的危害。</p>
<p>火狐下@的跳转。</p>
<p><img src="http://47.106.185.69/1/./img/1558102061.jpg" alt></p>
<p>还有一些是跳转目录的，</p>
<p>如：</p>
<pre><code>https://xx.xxx.com.cn/?redirect=/user/info.php</code></pre><p>修改为</p>
<pre><code>https://xx.xxx.com.cn/?redirect=@www.baidu.com</code></pre><p>这种情况通常@也可以跳转，大胆的去尝试</p>
<p>3.充值接口跳转</p>
<p>通常充值接口都会进行跳转，如充值成功会跳转到充值前访问的页面，因为充值接口需要充值才能知道到底存不存在漏洞，所以测试的人相对少一些，大胆去尝试，单车变摩托，充值完成后还可以提现其实并不影响，不嫌麻烦就多测测。这些都是跳转成功的案例。</p>
<p><img src="http://47.106.185.69/1/./img/1558102491.jpg" alt></p>
<p>4.xss造成的url跳转</p>
<p>在一次渗透测试中，碰到一个站点，对&lt;&gt;”这些字符都是进行了过滤。且没有其他姿势配合，基本上告别了XSS等漏洞。如下</p>
<p><img src="http://47.106.185.69/1/./img/1558102982.jpg" alt></p>
<p>可以发现我输入了xsstest&lt;&gt;”，但是&lt;&gt;被直接删除过滤掉了，但是发现双引号还在，先看下源码是怎么处理的。</p>
<p><img src="http://47.106.185.69/1/./img/1558103200.jpg" alt></p>
<p>乍一看双引号也被转义了，输入的xsstest 搜索有十七处，大部分被实体化了，还有一部分双引号被url编码了，但是此时突然发现我箭头指的一处并未对双引号进行转义或者过滤，虽然&lt;&gt;已经完全被过滤掉了。</p>
<p>此时构造meta的url跳转。</p>
<p>payload：</p>
<pre><code>http://xxx.com/search?w=1;url=http://www.baidu.com&quot; http-equiv=&quot;refresh&amp;fsearch=yes</code></pre><p>其中输入</p>
<pre><code>1;url=http://www.baidu.com&quot; http-equiv=&quot;refresh</code></pre><p>最终闭合掉得到的源码为。</p>
<p><img src="http://47.106.185.69/1/./img/1558103809.jpg" alt></p>
<p>最终点击payload会跳转百度页面，其实这个严格意义上来说算XSS造成的跳转，构造应该也可以XSS。</p>
<p>5.业务完成后跳转</p>
<p>这可以归结为一类跳转，比如修改密码，修改完成后跳转登陆页面，绑定银行卡，绑定成功后返回银行卡充值等页面，或者说给定一个链接办理VIP，但是你需要认证身份才能访问这个业务，这个时候通常会给定一个链接，认证之后跳转到刚刚要办理VIP的页面。</p>
<p>通常这个点都会存在跳转至于存不存在任意跳转，师傅们自测,有些跳转业务不好码就不发了。</p>
<p><img src="http://47.106.185.69/1/./img/1558155397.jpg" alt></p>
<p>6.用户交互</p>
<p>在一些用户交互页面也会出现跳转，如请填写对客服评价，评价成功跳转主页，填写问卷，等等业务，注意观察url。</p>
<p>问卷调查提交跳转。</p>
<p><img src="http://47.106.185.69/1/./img/1558155773.jpg" alt></p>
<p>ps:如果有其他小技巧我会更新到本篇文章。</p>
<p>参考：<a href="https://www.anquanke.com/post/id/94377?from=singlemessage" target="_blank" rel="noopener">https://www.anquanke.com/post/id/94377?from=singlemessage</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/05/17/url跳转实战/" data-id="ck0l0oh9p001epy2i4h11ub39" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web漏洞/">web漏洞</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/05/25/thinkphp3.2.3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          thinkphp框架学习
        
      </div>
    </a>
  
  
    <a href="/2019/04/20/反序列化学习/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">PHP反序列化学习</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web漏洞/">web漏洞</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂/">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/渗透攻防/">渗透攻防</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/web漏洞/" style="font-size: 18px;">web漏洞</a> <a href="/tags/杂/" style="font-size: 16px;">杂</a> <a href="/tags/渗透攻防/" style="font-size: 12px;">渗透攻防</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/25/csp内容安全策略/">csp内容安全策略</a>
          </li>
        
          <li>
            <a href="/2019/05/25/thinkphp3.2.3/">thinkphp框架学习</a>
          </li>
        
          <li>
            <a href="/2019/05/17/url跳转实战/">渗透之url跳转</a>
          </li>
        
          <li>
            <a href="/2019/04/20/反序列化学习/">PHP反序列化学习</a>
          </li>
        
          <li>
            <a href="/2019/04/14/2019DDCTF/">2019DDCTF</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>